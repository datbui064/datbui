@page "/tap1"
@using Radzen
@using Radzen.Blazor
@inject IJSRuntime JSRuntime
@inject DialogService DialogService

<h3>Tập 1: Chương Trình Đào Tạo</h3>
<div class="container">
    <EditForm Model="@tap1Data" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator />

        <label>Tên Chương Trình Đào Tạo:</label>
        <InputText @bind-Value="tap1Data.TenChuongTrinh" /><br />

        <label>Tên Học Phần Môn Học:</label>
        <InputText @bind-Value="tap1Data.TenHocPhan" /><br />

        <label>Mã Học Phần:</label>
        <InputText @bind-Value="tap1Data.MaHocPhan" /><br />

        <label>Mô Tả Nội dung:</label>
        <InputTextArea @bind-Value="tap1Data.MoTa" /><br />

        <label>Giảng Viên Phụ Trách:</label>
        <InputTextArea @bind-Value="tap1Data.GiangVien" /><br />

        <label>File Đính Kèm:</label>
        <InputFile @OnChange="HandleFileSelected" />

        <button type="button" class="btn btn-primary" @onclick="OpenDeCuongModal">Đề Cương Chi Tiết</button>
        <button type="submit" class="btn btn-success">Lưu thông tin</button>
    </EditForm>

    <!-- Radzen Modal -->
    @if (showDeCuongModal)
    {
        <RadzenDialog @ref="deCuongDialog" Title="Nhập Thông Tin Đề Cương Chi Tiết" CloseDialog="CloseDeCuongModal">
            <div>
                <label>Tên Đề Cương:</label>
                <InputText @bind-Value="tap1Data.TenDeCuong" class="form-control" /><br />

                <label>Nội Dung Đề Cương:</label>
                <InputTextArea @bind-Value="tap1Data.NoiDungDeCuong" class="form-control" /><br />
            </div>
            <div>
                <button type="button" class="btn btn-secondary" @onclick="CloseDeCuongModal">Đóng</button>
                <button type="button" class="btn btn-primary" @onclick="SaveDeCuong">Lưu Đề Cương</button>
            </div>
        </RadzenDialog>
    }
</div>

@code {
    private Tap1Data tap1Data = new();
    private IBrowserFile? uploadedFile;
    private bool showDeCuongModal = false;
    private RadzenDialog? deCuongDialog;

    private void HandleFileSelected(InputFileChangeEventArgs e)
    {
        uploadedFile = e.File;
    }

    private void OpenDeCuongModal()
    {
        showDeCuongModal = true;
    }

    private void CloseDeCuongModal()
    {
        showDeCuongModal = false;
    }

    private void SaveDeCuong()
    {
        // Logic để lưu thông tin đề cương
        Console.WriteLine("Đề Cương đã được lưu!");
        CloseDeCuongModal(); // Đóng modal sau khi lưu
    }

    private async Task HandleValidSubmit()
    {
        if (uploadedFile != null)
        {
            using var stream = uploadedFile.OpenReadStream();
            using var memoryStream = new MemoryStream();
            await stream.CopyToAsync(memoryStream);
            var fileBytes = memoryStream.ToArray();
            // Lưu fileBytes ở đây
        }
    }

    public class Tap1Data
    {
        public string? TenChuongTrinh { get; set; }
        public string? TenHocPhan { get; set; }
        public string? MaHocPhan { get; set; }
        public string? MoTa { get; set; }
        public string? GiangVien { get; set; }
        public string? TenDeCuong { get; set; }
        public string? NoiDungDeCuong { get; set; }
    }
}