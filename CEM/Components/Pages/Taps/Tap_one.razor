@page "/tap1"

@inject FileService fileService





<h3>Tập 1: Quyết định thành lập hồ sơ bài giảng</h3>

<EditForm Model="@tap1Data" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />

    <label>Số quyết định:</label>
    <InputText @bind-Value="tap1Data.SoQuyetDinh" /><br />

    <label>Ngày ban hành:</label>
    <InputDate @bind-Value="tap1Data.NgayBanHanh" /><br />

    <label>Cơ quan/đơn vị ban hành:</label>
    <InputText @bind-Value="tap1Data.CoQuanBanHanh" /><br />

    <label>Mô Tả Nội dung quyết định:</label>
    <InputTextArea @bind-Value="tap1Data.NoiDungQuyetDinh" /><br />

    <label>Người Phê Duyệt:</label>
    <InputTextArea @bind-Value="tap1Data.NguoiPheDuyet" /><br />

    <label>File Đính Kèm:</label>
    <InputFile @OnChange="HandleValidSubmit"/> 

    <button type="submit">Lưu thông tin</button>
</EditForm>

@code {
    private Tap1Data tap1Data = new();

    private IBrowserFile uploadedFile;

    private void HandleFileSelected(InputFileChangeEventArgs e)
    {
        uploadedFile = e.File;
    }

    private async Task HandleValidSubmit()
    {
        if (uploadedFile != null)
        {
            // Chuyển đổi file thành byte[]
            using var stream = uploadedFile.OpenReadStream();
            using var memoryStream = new MemoryStream();
            await stream.CopyToAsync(memoryStream);
            var fileBytes = memoryStream.ToArray();

            // Lưu file vào MinIO hoặc lưu trữ tạm thời
            await fileService.UploadFileAsync(uploadedFile.Name, fileBytes);
        }

        // Lưu thông tin khác vào cơ sở dữ liệu
    }

    public class Tap1Data
    {
        public string? SoQuyetDinh { get; set; }
        public DateTime? NgayBanHanh { get; set; }
        public string? CoQuanBanHanh { get; set; }
        public string? NoiDungQuyetDinh { get; set; }
        public string? NguoiPheDuyet { get; set; }
    }
}

