@page "/upload"
@inject MinioService MinioService

<h3>Upload File</h3>

<InputFile OnChange="HandleFileSelected" />
<button @onclick="UploadFile" disabled="@(!isFileSelected)">Upload</button>

@if (!string.IsNullOrEmpty(uploadStatus))
{
    <p>@uploadStatus</p>
}

@code {
    private IBrowserFile selectedFile;
    private string uploadStatus;
    private bool isFileSelected = false;

    private void HandleFileSelected(InputFileChangeEventArgs e)
    {
        selectedFile = e.File;
        isFileSelected = selectedFile != null;
        Console.WriteLine($"File selected: {selectedFile?.Name}, isFileSelected: {isFileSelected}");
    }

    private async Task UploadFile()
    {
        if (selectedFile != null)
        {
            using var stream = selectedFile.OpenReadStream(maxAllowedSize: 10 * 1024 * 1024); // Giới hạn kích thước tối đa 10MB
            var result = await MinioService.UploadFileAsync(selectedFile.Name, stream);

            uploadStatus = result ? "Upload thành công!" : "Upload không thành công!";
        }
        else
        {
            uploadStatus = "Vui lòng chọn file để upload.";
        }
    }
}
